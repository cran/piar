<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Index-number formulas</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Index-number formulas</h1>



<p>Price indexes based on a generalized mean of price relatives
constitute a large family of bilateral index-number formulas that are
consistent in aggregation, and any index based on the generalized mean
can be used to make and aggregate elemental indexes. To see how to make
superlative indexes as well, let’s start with a simple dataset of prices
and quantities for two businesses over three periods. We’ll be making
extensive use of the <em>gpindex</em> package for lower-level
price-index functions; see the help pages for that package to get more
detail.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(piar)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(gpindex)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>prices <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="at">period =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">each =</span> <span class="dv">6</span>),</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">product =</span> <span class="fu">paste0</span>(<span class="st">&quot;P&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="at">business =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;B1&quot;</span>, <span class="st">&quot;B2&quot;</span>), <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="at">price =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>,</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="at">quantity =</span> <span class="dv">18</span><span class="sc">:</span><span class="dv">1</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>prices[<span class="fu">c</span>(<span class="st">&quot;back_price&quot;</span>, <span class="st">&quot;back_quantity&quot;</span>)] <span class="ot">&lt;-</span> </span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  prices[<span class="fu">back_period</span>(prices<span class="sc">$</span>period, prices<span class="sc">$</span>product), <span class="fu">c</span>(<span class="st">&quot;price&quot;</span>, <span class="st">&quot;quantity&quot;</span>)]</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="fu">head</span>(prices)</span></code></pre></div>
<pre><code>##   period product business price quantity back_price back_quantity
## 1      1      P1       B1     1       18          1            18
## 2      1      P2       B1     2       17          2            17
## 3      1      P3       B1     3       16          3            16
## 4      1      P4       B2     4       15          4            15
## 5      1      P5       B2     5       14          5            14
## 6      1      P6       B2     6       13          6            13</code></pre>
<div id="basic-indexes" class="section level2">
<h2>Basic indexes</h2>
<p>As seen in <code>vignette(&quot;piar&quot;)</code>, by default the
<code>elemental_index()</code> function calculates a Jevons index
(equally-weighted geometric mean of price relatives). Although this is
the standard index-number formula for making elemental indexes, many
other types of index-numbers are possible. Among the unweighted
index-number formulas, the Carli index (equally-weighted arithmetic mean
of price relatives) is the historical competitor to the Jevons, and
requires specifying the order of the generalized mean <code>r</code>
when calling <code>elemental_index()</code>. An order of 1 corresponds
to an arithmetic mean.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>prices <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="fu">elemental_index</span>(price <span class="sc">/</span> back_price <span class="sc">~</span> period <span class="sc">+</span> business, <span class="at">r =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Period-over-period price index for 2 levels over 3 time periods 
##    1        2        3
## B1 1 4.666667 1.757937
## B2 1 2.233333 1.548485</code></pre>
<p>The Coggeshall index (equally-weighted harmonic mean of price
relatives) is another competitor to the Jevons, but is seldom used in
practice. Despite it being more exotic, it is just as easy to make by
specifying an order <code>r</code> of -1.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>prices <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="fu">elemental_index</span>(price <span class="sc">/</span> back_price <span class="sc">~</span> period <span class="sc">+</span> business, <span class="at">r =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Period-over-period price index for 2 levels over 3 time periods 
##    1        2        3
## B1 1 4.131148 1.754499
## B2 1 2.214765 1.547408</code></pre>
<p>Weights can be added to make, for example, elemental indexes using
the geometric Laspeyres formula.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>prices <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">elemental_index</span>(</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    price <span class="sc">/</span> back_price <span class="sc">~</span> period <span class="sc">+</span> business,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    <span class="at">weights =</span> back_price <span class="sc">*</span> back_quantity</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Period-over-period price index for 2 levels over 3 time periods 
##    1        2        3
## B1 1 3.853330 1.754015
## B2 1 2.202496 1.549081</code></pre>
<p>The type of mean used to aggregate elemental indexes can be
controlled in the same way in the call to <code>aggregate()</code>. The
default makes an arithmetic index, but any type of generalized-mean
index is possible.</p>
</div>
<div id="superlative-indexes" class="section level2">
<h2>Superlative indexes</h2>
<p>Many superlative indexes can be made by supplying unequal and
time-varying weights when making the elemental indexes, usually from
information about quantities. The Törnqvist index is a popular
superlative index-number formula, using average period-over-period value
shares as the weights in a geometric mean. As
<code>elemental_index()</code> makes a geometric index by default, all
that is needed to make a Törnqvist index is the weights.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>tw <span class="ot">&lt;-</span> <span class="fu">grouped</span>(<span class="fu">index_weights</span>(<span class="st">&quot;Tornqvist&quot;</span>))</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>prices <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="fu">elemental_index</span>(</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    price <span class="sc">/</span> back_price <span class="sc">~</span> period <span class="sc">+</span> business,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    <span class="at">weights =</span> <span class="fu">tw</span>(</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>      price, back_price, quantity, back_quantity,</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>      <span class="at">group =</span> <span class="fu">interaction</span>(period, business)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    )</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Period-over-period price index for 2 levels over 3 time periods 
##    1        2        3
## B1 1 4.087422 1.759213
## B2 1 2.215995 1.556014</code></pre>
<p>Making a Fisher index is more complex because it does not belong to
the generalized-mean family. Despite this, it is possible to make
weights to represent a Fisher index as a generalized mean of any
order.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>fw <span class="ot">&lt;-</span> <span class="fu">grouped</span>(<span class="fu">nested_transmute</span>(<span class="dv">0</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>), <span class="dv">0</span>))</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>prices <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="fu">elemental_index</span>(</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    price <span class="sc">/</span> back_price <span class="sc">~</span> period <span class="sc">+</span> business,</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    <span class="at">weights =</span> <span class="fu">fw</span>(</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>      price <span class="sc">/</span> back_price, back_price <span class="sc">*</span> back_quantity, price <span class="sc">*</span> quantity,</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>      <span class="at">group =</span> <span class="fu">interaction</span>(period, business)</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    )</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Period-over-period price index for 2 levels over 3 time periods 
##    1        2        3
## B1 1 4.076840 1.759215
## B2 1 2.215934 1.556046</code></pre>
<p>Aggregating with a superlative index is more complex, and is the
subject of <code>vignette(&quot;superlative-aggregation&quot;)</code>.</p>
</div>
<div id="product-contributions" class="section level2">
<h2>Product contributions</h2>
<p>As shown in <code>vignette(&quot;contributions&quot;)</code>, supplying
<code>contrib = TRUE</code> in the call to
<code>elemental_index()</code> makes percent-change product
contributions for each index value. The method used in this package is
flexible and works well for a variety of different index-number
formulas, but does not include all methods found in the literature. (See
the help page for <code>elemental_index()</code>, and the references
therein, for more detail about the exact methods.)</p>
<p>Let’s extend the previous example by calculating product
contributions for the Fisher index using the default method.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>fisher_index <span class="ot">&lt;-</span> prices <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">elemental_index</span>(</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    price <span class="sc">/</span> back_price <span class="sc">~</span> period <span class="sc">+</span> business,</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    <span class="at">weights =</span> <span class="fu">fw</span>(</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>      price <span class="sc">/</span> back_price, back_price <span class="sc">*</span> back_quantity, price <span class="sc">*</span> quantity,</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>      <span class="at">group =</span> <span class="fu">interaction</span>(period, business)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>    ),</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>    <span class="at">contrib =</span> <span class="cn">TRUE</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>  )</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="fu">contrib</span>(fisher_index, <span class="st">&quot;B1&quot;</span>)</span></code></pre></div>
<pre><code>##      1         2         3
## B1.1 0 1.1024526 0.2899319
## B1.2 0 1.0256151 0.2530718
## B1.3 0 0.9487724 0.2162114</code></pre>
<p>We can change the method used to make contributions for, say,
business <code>B1</code> by making a function to compute contributions
according to a different method</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>diewert_contributions <span class="ot">&lt;-</span> <span class="cf">function</span>(p1, p0, q1, q0) {</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  Pf <span class="ot">&lt;-</span> <span class="fu">fisher_index</span>(p1, p0, q1, q0)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  Pl <span class="ot">&lt;-</span> <span class="fu">laspeyres_index</span>(p1, p0, q0)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  wl <span class="ot">&lt;-</span> <span class="fu">scale_weights</span>(<span class="fu">index_weights</span>(<span class="st">&quot;Laspeyres&quot;</span>)(p0, q0))</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  wp <span class="ot">&lt;-</span> <span class="fu">scale_weights</span>(<span class="fu">index_weights</span>(<span class="st">&quot;HybridPaasche&quot;</span>)(p0, q1))</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  </span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> Pf) <span class="sc">*</span> wl <span class="sc">+</span> Pl <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> Pf) <span class="sc">*</span> wp) <span class="sc">*</span> (p1 <span class="sc">/</span> p0 <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>}</span></code></pre></div>
<p>and using this function to replace the contributions for business
<code>B1</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">contrib</span>(fisher_index, <span class="st">&quot;B1&quot;</span>) <span class="ot">&lt;-</span> <span class="fu">subset</span>(prices, business <span class="sc">==</span> <span class="st">&quot;B1&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="fu">split</span>(<span class="sc">~</span>period) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="fu">sapply</span>(</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>    \(df) <span class="fu">diewert_contributions</span>(</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>      df<span class="sc">$</span>price, df<span class="sc">$</span>back_price, df<span class="sc">$</span>quantity, df<span class="sc">$</span>back_quantity</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>    )</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>  )</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="fu">contrib</span>(fisher_index, <span class="st">&quot;B1&quot;</span>)</span></code></pre></div>
<pre><code>##   1         2         3
## 1 0 1.1124046 0.2937263
## 2 0 1.0256134 0.2530717
## 3 0 0.9388222 0.2124170</code></pre>
<p>Aggregating the elemental indexes will then consistently aggregate
the contributions for both businesses, even though they use different
methods.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
